<!DOCTYPE html>

<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">
<head>
   <meta charset="UTF-8" />
   <title>Passer un projet Flex sous maven + sonar</title>
   <meta name="author" content="danc" />
   <link href="/atom.xml" rel="alternate" title="Flux RSS" type="application/atom+xml" />

   <!-- Homepage CSS -->
    <link href='http://fonts.googleapis.com/css?family=Droid+Sans:regular,bold&amp;subset=latin' rel='stylesheet' type='text/css'>
   <link rel="stylesheet" href="/css/screen.css" type="text/css" media="screen, projection" />
   <link rel="stylesheet" href="/css/syntax.css" type="text/css" media="screen, projection" />
   <script src="/disqus.js" type="text/javascript"></script>
   <!-- ie hrml5 compat-->
   <script src="http://code.google.com/p/html5shiv/source/browse/trunk/html5.js"></script>
     <!-- Highslide JS + CSS -->
   <script type="text/javascript" src="/highslide/highslide-with-gallery.js"></script>
   <link rel="stylesheet" type="text/css" href="/highslide/highslide.css" />
   
   <script type="text/javascript">
hs.graphicsDir = '/highslide/graphics/';
hs.align = 'center';
hs.transitions = ['expand', 'crossfade'];
hs.outlineType = 'rounded-white';
hs.fadeInOut = true;
// hs.autoplay = true;
//hs.dimmingOpacity = 0.75;

// Add the controlbar
hs.addSlideshow({
	//slideshowGroup: 'group1',
	interval: 5000,
	repeat: false,
	useControls: true,
	fixedControls: 'fit',
	overlayOptions: {
		opacity: .75,
		position: 'bottom center',
		hideOnMouseOut: true
	}
});
</script>
   
</head>
<body>
<header>
<div class="bandeau1"><a href="/">&nbsp;</a></div>
<div class="bandeau">
	<span class="top">
		<a href="/">root</a>  &nbsp;&nbsp;
	<span class="topics">   
		<a href="/tag/">tags</a> 
	</span>
	</span>
	<span><a href="/tag/presentation">à propos</a></span>&nbsp;
	<!--span><a href="/tag/lien">liens</a></span-->&nbsp;
</div>
<br/>
<span class="date">
	<a class="zoom" href="/2010">2010</a>  
	<a class="zoom" href="/2010/12">12</a>   
	07
</span>

</header>
<section>
<div class="site">
  <nav>
<span id="categories">

    
        
      <a href="/tag/flex">flex</a> &nbsp;
    
      <a href="/tag/maven">maven</a> &nbsp;
    
      <a href="/tag/sonar">sonar</a> &nbsp;
    
      <a href="/tag/nexus">nexus</a> &nbsp;
    
  
</span>
</nav>
<!--div id="post"-->
<article id="post">
<h1>Passer un projet Flex sous maven + sonar</h1>

<p>Après la mise en place d&#8217;un proxy nexus ( <a href="/wiki/#Installation_nexus">notes d&#8217;installation sur le wiki</a> ), l&#8217;étape suivante consiste à tester la mise en place de maven + sonar sur un projet Flex existant.</p>
<p>On suppose que le poste développeur est configuré pour <a href="/slide/maven-nexus-sonar/#11">pointer sur le nexus local</a> .</p>
<p>les remarques suivantes porteront sur les étapes principales pour que le projet compile sous maven :</p>
<ul>
	<li>affinage du pom.xml</li>
	<li>déclaration des repositories/artifacts nécessaires dans le nexus</li>
</ul>
<p>On ne gèrera pas tous les détails  propres au projet (paramètres, i18n, &#8230;). L&#8217;objectif est que les  commandes suivantes passent :</p>
<div class="highlight"><pre><code class="bat"><span class="lineno">1</span>  mvn compile
<span class="lineno">2</span>  mvn package
<span class="lineno">3</span>  mvn sonar:sonar 
</code></pre></div><h2>organisation du projet</h2>
<p>On suppose que le projets est composé de trois modules , un en java, les deux autres en flex.</p>
<p>La première étape consiste à créer un pom.xml à la racine de chacun de ces trois modules. <br />
On les mettra au point séparément, avant de déclarer un pom global au projet qui ne fera que référencer chacun des modules.</p>
<p>Pour les modules Flex, on utilisera le modèle de pom généré par un archetype flex-mojos :</p>
<div class="highlight"><pre><code class="bat"><span class="lineno">1</span> mvn archetype:generate 
<span class="lineno">2</span> 	-DarchetypeRepository<span class="o">=</span>http:<span class="n">//repository.sonatype.org/content/groups/flexgroup/</span> 
<span class="lineno">3</span> 	-DarchetypeGroupId<span class="o">=</span>org.sonatype.flexmojos 
<span class="lineno">4</span> 	-DarchetypeArtifactId<span class="o">=</span>flexmojos-archetypes-application 
<span class="lineno">5</span> 	-DarchetypeVersion<span class="o">=</span><span class="m">3</span>.<span class="m">0</span>.<span class="m">0</span>
<span class="lineno">6</span>  
</code></pre></div>
Le fichier xml ainsi généré sera du genre:

<div class="highlight"><pre><code class="xml"><span class="lineno"> 1</span> <span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> 
<span class="lineno"> 2</span> 	<span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="lineno"> 3</span> 	<span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 </span>
<span class="lineno"> 4</span> <span class="s">			http://maven.apache.org/maven-v4_0_0.xsd&quot;</span><span class="nt">&gt;</span>
<span class="lineno"> 5</span>     <span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;</span>
<span class="lineno"> 6</span>   <span class="nt">&lt;parent&gt;</span>
<span class="lineno"> 7</span>     <span class="nt">&lt;groupId&gt;</span>org.sonatype.flexmojos<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno"> 8</span>     <span class="nt">&lt;artifactId&gt;</span>flexmojos-flex-super-pom<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno"> 9</span>     <span class="nt">&lt;version&gt;</span>3.0.0<span class="nt">&lt;/version&gt;</span>
<span class="lineno">10</span>   <span class="nt">&lt;/parent&gt;</span>
<span class="lineno">11</span>   
<span class="lineno">12</span>   <span class="nt">&lt;groupId&gt;</span>YOURPROJECT<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">13</span>   <span class="nt">&lt;artifactId&gt;</span>YOURARTIFACT<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">14</span>   <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="lineno">15</span>   <span class="nt">&lt;packaging&gt;</span>swf<span class="nt">&lt;/packaging&gt;</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>   <span class="nt">&lt;name&gt;</span>Test Flex Maven<span class="nt">&lt;/name&gt;</span>
<span class="lineno">18</span>   <span class="nt">&lt;/project&gt;</span>
</code></pre></div>
L&#8217;appel de maven nous permet de trouver pas à pas les modifications à apporter à la structure du code :

<ul>
	<li>respect de l&#8217;arborescenve maven attendue pour un projet flex (  src/main/flex )</li>
	<li>déclaration des dépendences</li>
</ul>
Par exemple pour un projet Flex qui dépendait d&#8217;une librairie Cairngorm particulière :

<div class="highlight"><pre><code class="xml"><span class="lineno">1</span> <span class="nt">&lt;dependencies&gt;</span>
<span class="lineno">2</span>   <span class="nt">&lt;dependency&gt;</span>
<span class="lineno">3</span>     <span class="nt">&lt;groupId&gt;</span>com.adobe.cairngorm.business<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">4</span>     <span class="nt">&lt;artifactId&gt;</span>ServiceLocator<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">5</span>     <span class="nt">&lt;version&gt;</span>2.2.1<span class="nt">&lt;/version&gt;</span>
<span class="lineno">6</span>     <span class="nt">&lt;type&gt;</span>swc<span class="nt">&lt;/type&gt;</span>
<span class="lineno">7</span>     <span class="nt">&lt;scope&gt;</span>compile<span class="nt">&lt;/scope&gt;</span>
<span class="lineno">8</span>   <span class="nt">&lt;/dependency&gt;</span>
<span class="lineno">9</span> <span class="nt">&lt;/dependencies&gt;</span>
</code></pre></div><p>On peut noter que par rapport à un projet <strong>ant</strong>, <strong>maven</strong> se contente de déclarer les dépendances dont le projet a besoin, alors que <strong>ant</strong> a besoin de décrire en détail la façon dont les dépendances doivent être prises en compte.<br />
On verra plus loin comment prendre en compte effectivement une librairie  externe dans notre repository.</p>
<h2>modifications des pom.xml</h2>
<p>Le module java était déjà &#8220;mavenisé&#8221;, il comportait déjà un pom.xml<br />
On pourra toutefois le simplifier en supprimant les déclarations des repositories, qui sont dans notre optique gérés par nexus.</p>
<table>
	<tr>
		<td>règle #1 : alléger au maximum le pom.xml, en remontant un maximum d&#8217;informations dans les poms parents, ou dans le repository manager</td>
	</tr>
</table>
<h2>déclarer un artifact dans le repository</h2>
<p>On a vu plus haut que les dépendances étaient simplement déclarées dans le pom.xml. Ces dépendances peuvent</p>
<ul>
	<li>appartenir à un repository maven identifié</li>
	<li>être fournies en tant que librairie autonome (.jar, .swc, &#8230;)</li>
</ul>
<p>Dans le premier cas, on peut déclarer le repository correspondant dans le pom.xml, mais en application de la règle #1, on préférera laisser ce travail au gestionnaire de repository local (nexus dans notre cas).<br />
Cela permet d&#8217;appliquer une politique cohérente de gestion des dépendances au niveau de l&#8217;entreprise, au détriment toutefois d&#8217;une certaine souplesse laissée aux développeurs.<br />
Si un projet a besoin d&#8217;une librairie particulière ou d&#8217;un repository non encode géré par nexus, l&#8217;équipe devra s&#8217;adresser au gestionnaire de nexus pour qu&#8217;il donne accès aux repository/librairies concernées pour le projet.</p>
<p>On ne rentrera pas ici dans la gestion complète d&#8217;un nexus par exemple, mais on décrira simplement l&#8217;ajoutd &#8216;une librairie Flex .swc dans nexus. La librairie demandée (Cairngorm_2.2.1.swc) n&#8217;est pas référencée dans un repository maven connu : on va donc la déclarer explicitement dans nexus, la rendant ainsi potentiellement disponible à tous les projets.</p>
<p>Pour satisfaire la dépendance décrite plus haut (le projet utilise la classe ServiceLocator dans le package  com.adobe.cairngorm.business,  le tout étant fourni par un fichier Cairngorm_2.2.1.swc) , on ajoutera dans le repository &#8216;third party&#8217;  (Repository/third party/Artifact upload) de nexus le fichier swc, accompagné de la description suivante :</p>
<ul>
	<li>groupId (com.adobe.cairngorm.business)</li>
	<li>artifactId (ServiceLocator)</li>
	<li>version (2.2.1)</li>
	<li>type (swc)</li>
</ul>
<A HREF="/img/nexus-upload-artifact.jpg" class="highslide" onclick="return hs.expand(this)">Copie d&#8217;écran correspondante à l&#8217;ajout manuel d&#8217;un artifact</A>
<p>Il est aussi possible d&#8217;affectuer cette manipulation en ligne de commande avec maven:</p>
<div class="highlight"><pre><code class="bat"><span class="lineno">1</span> mvn deploy:deploy-file 
<span class="lineno">2</span>   -DgroupId<span class="o">=</span>com.adobe.cairngorm.business 
<span class="lineno">3</span>   -DartifactId<span class="o">=</span>ServiceLocator
<span class="lineno">4</span>   -Dversion<span class="o">=</span><span class="m">2</span>.<span class="m">2</span>.<span class="m">1</span> 
<span class="lineno">5</span>   -Dpackaging<span class="o">=</span>swc 
<span class="lineno">6</span>   -Dfile<span class="o">=</span><span class="n">/path/to/Cairngorm_2.2.1.swc</span> 
<span class="lineno">7</span>   -Durl<span class="o">=</span>http:<span class="n">//nexus-rennes.sii.fr/content/repositories/thirdparty</span>
<span class="lineno">8</span>   -DrepositoryId<span class="o">=</span>thirdparty
</code></pre></div><p>Il est alors nécessaire de demander sous nexus une réindexation du repository (thirdparty et public, qui inclut par défaut thirdparty), afin que les nouveaux artifacts soient effectivement accessibles aux équipes qui dont la configuration maven pointe sur le répoertoire public (http://nexus-rennes.sii.fr/content/groups/public/).</p>
<p>On peut constater que l&#8217;on peut gérer autant de repositories maven que nécessaires et attribuer des accès différenciés en fonction des droits, des besoins des équipes, &#8230;</p>
<h2>Un bilan temporaire</h2>
<p>A ce niveau, chaque module passe sous maven, une fois les dépendances correctement décrites et les repositories mis à jour (ajout d&#8217;artifacts manquants, ajout de nouveaux repositories + réindexation).</p>
<p>Dans la mesure ou sonar est installé  (en local ou dans le réseau de l&#8217;entreprise), <strong><a href="http://docs.codehaus.org/display/SONAR/Flex+Plugin">avec le plugin Flex</a> installé</strong><br />
 on peut déjà invoquer sonar à partir de maven :</p>
<div class="highlight"><pre><code class="bat"><span class="lineno">1</span> mvn sonar:sonar
</code></pre></div><p>Les projets flex, pour bénéficier d&#8217;outils d&#8217;analyse propres à Flex, ont besoin de déclarer quelques propriétés dans le pom.xml, exemple :</p>
<ul>
	<li>déclaration du langage pour que sonar détermine les règles syntaxiques à appliquer au code</li>
	<li>paramètres d&#8217;analyse</li>
	<li>gestion du code source dans Sonar</li>
</ul>
<div class="highlight"><pre><code class="xml"><span class="lineno">1</span>   <span class="nt">&lt;properties&gt;</span>
<span class="lineno">2</span>     <span class="nt">&lt;sonar.language&gt;</span>flex<span class="nt">&lt;/sonar.language&gt;</span>
<span class="lineno">3</span>     <span class="nt">&lt;sonar.dynamicAnalysis&gt;</span>false<span class="nt">&lt;/sonar.dynamicAnalysis&gt;</span>
<span class="lineno">4</span>     <span class="nt">&lt;sonar.phase&gt;</span>generate-sources<span class="nt">&lt;/sonar.phase&gt;</span>
<span class="lineno">5</span>   <span class="nt">&lt;/properties&gt;</span>
</code></pre></div><p>Et le résultat :</p>
<A HREF="/img/flex-sonar.jpg" class="highslide" onclick="return hs.expand(this)">Ecran sonar principal : analyse d&#8217;un projet Flex</A>
<p><a href="http://docs.codehaus.org/display/SONAR/Collect+data">Plus de détails sur les paramètres sonar</a></p>
<h2>La suite (et fin ?)</h2>
<p>Il est enfin utile de regrouper les différents modules de l&#8217;application en créant un pom.xml commun à tous les modules qui va les référencer de la manière suivante :</p>
<div class="highlight"><pre><code class="xml"><span class="lineno">1</span>  	<span class="nt">&lt;modules&gt;</span>
<span class="lineno">2</span> 		<span class="nt">&lt;module&gt;</span>flex-gui<span class="nt">&lt;/module&gt;</span>
<span class="lineno">3</span> 		<span class="nt">&lt;module&gt;</span>java-service<span class="nt">&lt;/module&gt;</span>
<span class="lineno">4</span> 		<span class="nt">&lt;module&gt;</span>web-app<span class="nt">&lt;/module&gt;</span>
<span class="lineno">5</span> 	<span class="nt">&lt;/modules&gt;</span>
</code></pre></div><p>On suppose ici que les modules se trouvent dans les sous répertoires immédiats de l&#8217;endroit où se trouve le pom.xml parent. Il ne s&#8217;agit pas de dépendances, (sans quoi on aurait utilisé la notation dédiée), mais bien de modules cohérents pour un même projet. <br />
Rien n&#8217;empêche d&#8217;imaginer qu&#8217;à terme un module devienne une librairie indépendante utilisée par plusieurs projets.</p>
<p>Chaque module référencé devra quand à lui pointer sur son pom parent :</p>
<div class="highlight"><pre><code class="xml"><span class="lineno">1</span> 	<span class="nt">&lt;parent&gt;</span>
<span class="lineno">2</span> 	    <span class="nt">&lt;groupId&gt;</span>fr.sii.projet-multi-modules<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">3</span> 	    <span class="nt">&lt;artifactId&gt;</span>projet-multi-modules<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">4</span> 	    <span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
<span class="lineno">5</span> 	<span class="nt">&lt;/parent&gt;</span>	
</code></pre></div><p>On peut noter que seule la référence groupe/artifact/version est nécessaire, et non son chemin relatif.</p>
<p>On pourra profiter  de l&#8217;occasion pour remonter un maximum d&#8217;informations communes vers le pom parent (version du logiciel en tant que <em>property</em>, gestion des dépendances communes ou <em>dependencyManagement</em> , &#8230; )<br />
Afin de ne pas avoir deux parents dans les projets Flex, il a été nécessaire de remonter la définition suivante dans le pom parent <sup class="footnote" id="fnr1"><a href="#fn1">1</a></sup> :</p>
<div class="highlight"><pre><code class="xml"><span class="lineno">1</span>   <span class="nt">&lt;parent&gt;</span>
<span class="lineno">2</span>     <span class="nt">&lt;groupId&gt;</span>org.sonatype.flexmojos<span class="nt">&lt;/groupId&gt;</span>
<span class="lineno">3</span>     <span class="nt">&lt;artifactId&gt;</span>flexmojos-flex-super-pom<span class="nt">&lt;/artifactId&gt;</span>
<span class="lineno">4</span>     <span class="nt">&lt;version&gt;</span>3.0.0<span class="nt">&lt;/version&gt;</span>
<span class="lineno">5</span>   <span class="nt">&lt;/parent&gt;</span>
<span class="lineno">6</span>   
</code></pre></div>
<p>Cette définition permet de définir le projet en tant que projet flex, et d&#8217;utiliser les plugins maven nécessaires. Le fait de le remonter dans le pom père ne semble pas avoir d&#8217;effet négatif sur le module java.</p>
<p class="footnote" id="fn1"><a href="#fnr1"><sup>1</sup></a> pas de multi héritage dans maven ?</p>

</article>

<footer>

<div class="prevnext"> 
	<a class="prev" href="/2010/12/poo-js-dojo">
	&larr;   Dojo et Programmation Objet</a> &nbsp; 
  
  
	<a class="next" href="/2010/12/industrialisaton-logiciel"> 
  Slides industrialisation de la production logicielle &rarr; </a>
  
</div>

<hr>

<div class="comments">
 <a href="#disqus_thread" onclick="showComments('http://danc.alwaysdata.net', '/2010/12/flex-maven-sonar')" >vos commentaires ...</a>
 <div class="p" id="comments"></div>
</div>
<script type="text/javascript">

    var disqus_shortname = 'danc'; 
    
    (function () {
        var s = document.createElement('script'); s.async = true;
        s.type = 'text/javascript';
        s.src = 'http://disqus.com/forums/' + disqus_shortname + '/count.js';
        (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
    }());
</script>
</footer>

</div>
</section>
</body>
</html>
